# problem-forge: 프로젝트 계획 및 현황

## 1. 프로젝트 개요

- **프로젝트명:** problem-forge
- **목표:** 사용자가 제공하는 수능 스타일 영어 지문(텍스트, PDF, 이미지)을 기반으로, 다양한 유형의 변형 문제를 자동으로 생성하는 AI 에이전트 시스템 구축.
- **주요 타겟:** 수험생, 학원 강사, 교사 등 대학 입시 관련 사용자.

## 2. 구현 계획 및 현황

### Phase 1: 프로젝트 설정 (Task #1) ✅
- [x] Git 레포지토리 및 개발 환경 설정
- [x] `src`, `node_modules` 등 디렉토리 구조화
- [x] `package.json`, `pyproject.toml` 등 빌드 시스템 구성

### Phase 2: 프론트엔드 UI 및 입력 기능 (Task #2, #9) ✅
- [x] React 기반 채팅 UI 구현 (`ChatSidebar`, `ChatWindow`, `ChatInput`)
- [x] 로그인, 대화 생성/삭제/수정 기능 구현
- [x] 텍스트 및 PDF 파일 첨부 기능 구현
- [x] 클라이언트 사이드 PDF 텍스트 추출 (`pdfjs-dist`)
- [x] **(완료)** 다중 문제 선택 UI 구현
- [x] **(완료)** 첫 메시지 기반으로 대화 제목 자동 생성 기능 추가
- [x] **(완료)** 생성된 여러 문제를 구조화된 UI(e.g. 아코디언)로 표시

### Phase 3: 백엔드 파일 변환 및 전처리 (Task #3) 🔄
- [x] ~~`pdfplumber`를 이용한 PDF → 텍스트 변환 모듈 구현~~ (프론트엔드로 이전)
- [x] **(완료)** PDF/텍스트 내 다중 문제 분리 로직 구현 (`preprocess.py`)
- [x] **(완료)** 문제 분할 API 엔드포인트 추가 (`/api/split-problems`)
- [x] **(완료)** 클라이언트/백엔드 파일 처리 역할 재정의 및 데드 코드 제거
- [ ] **(개선 필요)** 문제 파싱 로직 정확도 향상 - 현재 파싱 로직의 문제점 개선 및 다양한 문제 형식 대응
- [ ] **(추후 확장)** 이미지 → 텍스트 변환 (OCR) 기능 구현

### Phase 4: AI 에이전트 문제 생성 (Task #4, #7) ✅
- [x] `google-adk` 기반 계층적 에이전트 구조 설계 (`root`, `master`, `parallel`)
- [x] 8가지 유형별 문제 생성 에이전트 정의 (`src/agent`)
- [x] 전체 에이전트 파이프라인 통합 및 엔드투엔드 테스트 완료
- [ ] **(추후 확장)** PRD 기반 미구현 7개 문제 유형 에이전트 추가 개발

### Phase 5: 해설 및 정답 생성 (Task #5) ✅
- [x] 각 에이전트 `instruction.py`에 JSON 형식의 해설/정답 생성 로직 통합

### Phase 6: PDF 다운로드 기능 (Task #6) ✅
- [x] **(완료)** 생성된 결과물 PDF 다운로드 기능 구현

### Phase 7: API 서버 구축 (Task #7) ✅
- [x] FastAPI 기반 API 서버 구현 (`server.py`)
- [x] 에이전트 호스팅 및 CORS 설정
- [x] 로그인 API (`/api/login`) 구현
- [x] **(완료)** 다중 문제 병렬 처리 로직 구현 (프론트엔드 주도)
- [x] **(완료)** 서버 코드 구조 최적화 (타입 힌트, 로깅, 문서화, 에러 핸들링 개선)
- [ ] **(추후 확장)** 비밀번호 해싱(e.g., `passlib`)을 적용하여 로그인 보안 강화

### Phase 8: 테스트 (Task #10) ✅
- [x] **(완료)** 핵심 API 엔드포인트(`login`, `split-problems`, `generate-title`, `/agent/run`)에 대한 단위/통합 테스트 추가
- [x] **백엔드 API 테스트 강화:** `pytest`를 `uv` 개발 의존성에 추가하고, `sys.path` 임포트 문제를 해결하여 모든 테스트 케이스가 성공적으로 통과하도록 구현
- [ ] **(개선)** 전반적인 테스트 커버리지 확대 (프론트엔드 및 추가 백엔드 로직)

## 3. 🎯 구현 완료된 핵심 기능
✅ **React 기반 채팅 UI**: 로그인, 대화 관리, 제목 자동 생성 기능 포함.  
✅ **다중 입력 방식 지원**: 텍스트 직접 입력 및 PDF 파일 첨부.  
✅ **다중 문제 처리 및 선택**: 단일 PDF/텍스트 입력 내 여러 문제를 자동으로 분할하고, 사용자가 변형할 문제를 직접 선택 가능.  
✅ **계층적 AI 에이전트**: `google-adk`를 활용, 8가지 수능 영어 문제 유형 생성을 위한 특화 에이전트 및 관리 에이전트 구현.  
✅ **FastAPI 기반 API 서버**: 에이전트 실행 및 유틸리티 API(문제 분할, 제목 생성) 제공.
✅ **PDF 다운로드**: 생성된 문제 텍스트를 한글 폰트를 내장하여 PDF로 다운로드.
✅ **구조화된 결과 표시**: 다중 문제 결과를 아코디언 UI로 제공하여 가독성 향상.
✅ **최적화된 아키텍처**: 프론트엔드 주도 구조 확립, 백엔드 코드 품질 개선, 의존성 경량화 완료.

## 4. 구현 노트
- **아키텍처**: **프론트엔드 주도(Front-end Driven)** 아키텍처. 복잡한 다중 문제 처리 로직을 프론트엔드(`App.js`)에서 담당하여 백엔드 서버를 단순하고 안정적으로 유지.
- **프론트엔드**: `create-react-app`, `axios`, `jspdf`, `pdfjs-dist` 사용.
- **백엔드**: `Python`, `FastAPI`, `uvicorn`, `google-adk` 사용.
- **PDF 처리**: 클라이언트 사이드에서 `pdfjs-dist`를 사용하여 브라우저 내 텍스트 추출.

## 5. 아키텍처 정리 완료 ✅ (2024년 12월)
- **✅ 완료된 정리 작업:**
  - **데드 코드 제거**: 4개 미사용 파일 삭제 (`convert_file.py`, `pdf_to_text.py`, `pdf_to_markdown.py`, `api.py`)
  - **의존성 최적화**: 93개 → 89개 패키지로 경량화 (`pdfplumber` 등 제거)
  - **개발 문서 정리**: 히스토리 파일 간소화 및 통합
  - **코드 구조 최적화**: `server.py` 완전 리팩토링 (타입 힌트, 로깅, 문서화)
  - **검증 완료**: 6개 테스트 모두 통과, 프론트엔드 빌드 성공

## 6. 최근 추가 구현 (2024년 12월)
- **✅ 문제 텍스트 전체 보기 기능**: PDF 파싱된 문제 선택 화면에서 100자 제한 텍스트를 토글 버튼으로 전체 확인 가능하도록 개선
  - 각 문제별 독립적인 펼침/접힘 상태 관리
  - 직관적인 UI (체크박스 + 텍스트 + 토글버튼)
  - 사용성 개선 (스크롤, hover 효과, 상태 초기화)

## 7. MVP 완료를 위한 남은 작업
- **1순위 (정확성):**
  - 문제 파싱 로직 정확도 향상 - 현재 파싱 알고리즘 개선 및 다양한 문제 형식 대응 (Phase 3)
- **2순위 (안정성):**
  - 테스트 커버리지 확대, 특히 `/run` 엔드포인트에 대한 통합 테스트 (Phase 8)

## 8. 추후 확장 계획 (우선순위 순)
- **1순위 - 에이전트 기능 확장:** 미구현된 7개 유형 문제 생성 에이전트 추가 개발 (Phase 4)
- **2순위 - 이미지 입력 처리(OCR):** 이미지 파일 입력을 위한 OCR 기능 추가 (Phase 3)
- **3순위 - 로그인 보안 강화:** 로그인 시 비밀번호 해싱 적용 (Phase 7)
- **4순위 - 성능 최적화:** 캐싱, 배치 처리, 병렬화 개선